sudo: false
language: cpp
compiler:
  - gcc
  - clang

install:
  - if [ "$CXX" = "g++" ]; then export CXX="g++-4.8" CC="gcc-4.8"; fi
  - cd ${TRAVIS_BUILD_DIR}
  - mkdir deps
  - cd deps
  # install newer lcov
  - wget http://ftp.de.debian.org/debian/pool/main/l/lcov/lcov_1.11.orig.tar.gz
  - tar xf lcov_1.11.orig.tar.gz
  - mkdir opt
  - PREFIX=`pwd`/opt make -C lcov-1.11/ install
  # install coveralls-lcov
  - mkdir gems
  - gem install -i gems coveralls-lcov

before_script:
  - cd ${TRAVIS_BUILD_DIR}/test
  - lcov --directory . --zerocounters

script:
  - cd ${TRAVIS_BUILD_DIR}/test
  # update PATH (for lcov and coveralls-lcov)
  - DEPS=${TRAVIS_BUILD_DIR}/deps
  - PATH=${DEPS}/opt/usr/bin:${DEPS}/gems/bin:$PATH
  - g++-4.8 -std=c++11 -o test_notch_with_coverage --coverage -I.. test_*.cpp
  - ./test_notch_with_coverage

after_success:
  - cd ${TRAVIS_BUILD_DIR}/test
  - lcov --capture --directory . --output-file coverage.info
  - lcov --remove coverage.info 'test/*' '/usr/*' --output-file coverage.info
  - lcov --list coverage.info
  - coveralls-lcov --repo-token NONE_YET --dry-run coverage.info

addons:
  apt:
    sources:
    - ubuntu-toolchain-r-test
    packages:
    - gcc-4.8
    - g++-4.8
    - clang
